<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SisiriGroup - สร้างใบเสนอราคา</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f4; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 5px; border: 1px solid #ddd; box-sizing: border-box; }
        button { background-color: #00b900; color: white; border: none; font-size: 16px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div class="card">
        <h2>ออกใบเสนอราคา (Sisiri)</h2>
        <label>ชื่อลูกค้า</label>
        <input type="text" id="customerName" placeholder="ระบุชื่อลูกค้า">
        <label>เลือกรายการสินค้า</label>
        <select id="product">
            <option value="สินค้า A|500">สินค้า A (500 บาท)</option>
            <option value="สินค้า B|1200">สินค้า B (1,200 บาท)</option>
        </select>
        <label>จำนวน</label>
        <input type="number" id="qty" value="1" min="1">
        <button onclick="sendToN8n()">สร้างใบเสนอราคา</button>
    </div>

    <script>
        async function main() {
            // ใส่ LIFF ID ที่คุณได้จาก LINE Developers
            await liff.init({ liffId: "2009047896-v7xmeGBn" });
            if (!liff.isLoggedIn()) { liff.login(); }
        }

        async function sendToN8n() {
            const profile = await liff.getProfile();
            const productInfo = document.getElementById('product').value.split('|');
            
            const data = {
                userId: profile.userId,
                displayName: profile.displayName,
                customerName: document.getElementById('customerName').value,
                productName: productInfo[0],
                price: parseFloat(productInfo[1]),
                qty: parseInt(document.getElementById('qty').value),
                total: parseFloat(productInfo[1]) * parseInt(document.getElementById('qty').value),
                date: new Date().toLocaleString('th-TH')
            };

            // วาง URL ที่ก๊อบมาจาก n8n Cloud (Test URL) ในเครื่องหมายคำพูดด้านล่างนี้ครับ
            const n8n_webhook_url = "https://klanaja.app.n8n.cloud/webhook-test/SisiriGroup";

            try {
                const response = await fetch(n8n_webhook_url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    alert("ส่งข้อมูลสำเร็จ! ตรวจสอบที่หน้า n8n ได้เลยครับ");
                    liff.closeWindow();
                } else {
                    alert("ส่งข้อมูลไม่สำเร็จ กรุณาตรวจสอบ Webhook URL");
                }
            } catch (error) {
                console.error(error);
                alert("เกิดข้อผิดพลาด: " + error.message);
            }
        }
        main();
    </script>
</body>
</html>
